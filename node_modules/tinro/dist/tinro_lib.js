import{getContext as F}from"svelte";import{writable as T}from"svelte/store";function p(e,a=!1){return e=e.slice(e.startsWith("/#")?2:0,e.endsWith("/*")?-2:void 0),e.startsWith("/")||(e="/"+e),e==="/"&&(e=""),a&&!e.endsWith("/")&&(e+="/"),e}function d(e,a){e=p(e,!0),a=p(a,!0);let r=[],n={},t=!0,s=e.split("/").map(c=>c.startsWith(":")?(r.push(c.slice(1)),"([^\\/]+)"):c).join("\\/"),o=a.match(new RegExp(`^${s}$`));return o||(t=!1,o=a.match(new RegExp(`^${s}`))),o?(r.forEach((c,m)=>n[c]=o[m+1]),{exact:t,params:n,part:o[0].slice(0,-1)}):null}function x(e,a,r){if(r==="")return e;if(r[0]==="/")return r;let n=o=>o.split("/").filter(c=>c!==""),t=n(e),s=a?n(a):[];return"/"+s.map((o,c)=>t[c]).join("/")+"/"+r}function f(e,a,r,n){let t=[a,"data-"+a].reduce((s,o)=>{let c=e.getAttribute(o);return r&&e.removeAttribute(o),c===null?s:c},!1);return!n&&t===""?!0:t||n||!1}function O(e){let a=e.split("&").map(r=>r.split("=")).reduce((r,n)=>{let t=n[0];if(!t)return r;let s=n.length>1?n[n.length-1]:!0;return typeof s=="string"&&s.includes(",")&&(s=s.split(",")),r[t]===void 0?r[t]=[s]:r[t].push(s),r},{});return Object.entries(a).reduce((r,n)=>(r[n[0]]=n[1].length>1?n[1]:n[1][0],r),{})}function S(e){return Object.entries(e).map(([a,r])=>r?r===!0?a:`${a}=${Array.isArray(r)?r.join(","):r}`:null).filter(a=>a).join("&")}function w(e,a){return e?a+e:""}function k(e){throw new Error("[Tinro] "+e)}var i={HISTORY:1,HASH:2,MEMORY:3,OFF:4,run(e,a,r,n){return e===this.HISTORY?a&&a():e===this.HASH?r&&r():n&&n()},getDefault(){return!window||window.location.pathname==="srcdoc"?this.MEMORY:this.HISTORY}};var R,v,M,l=_();function _(){let e=i.getDefault(),a,r=o=>window.onhashchange=window.onpopstate=R=null,n=o=>a&&a(y(e)),t=o=>{o&&(e=o),r(),e!==i.OFF&&i.run(e,c=>window.onpopstate=n,c=>window.onhashchange=n)&&n()},s=o=>{let c=Object.assign(y(e),o);return c.path+w(S(c.query),"?")+w(c.hash,"#")};return{mode:t,get:o=>y(e),go(o,c){A(e,o,c),n()},start(o){a=o,t()},stop(){a=null,t(i.OFF)},set(o){this.go(s(o),!o.path)},methods(){return C(this)}}}function A(e,a,r){!r&&(v=M);let n=t=>history[`${r?"replace":"push"}State`]({},"",t);i.run(e,t=>n(a),t=>n(`#${a}`),t=>R=a)}function y(e){let a=window.location,r=i.run(e,t=>a.pathname+a.search+a.hash,t=>String(a.hash.slice(1)||"/"),t=>R||"/"),n=r.match(/^([^?#]+)(?:\?([^#]+))?(?:\#(.+))?$/);return M=r,{url:r,from:v,path:n[1]||"",query:O(n[2]||""),hash:n[3]||""}}function C(e){let a=()=>e.get().query,r=o=>e.set({query:o}),n=o=>r(o(a())),t=()=>e.get().hash,s=o=>e.set({hash:o});return{hash:{get:t,set:s,clear:()=>s("")},query:{replace:r,clear:()=>r(""),get(o){return o?a()[o]:a()},set(o,c){n(m=>(m[o]=c,m))},delete(o){n(c=>(c[o]&&delete c[o],c))}}}}var h=Y();function Y(){let{subscribe:e}=T(l.get(),a=>{l.start(a);let r=P(l.go);return()=>{l.stop(),r()}});return{subscribe:e,goto:l.go,params:Q,meta:b,useHashNavigation:a=>l.mode(a?i.HASH:i.HISTORY),mode:{hash:()=>l.mode(i.HASH),history:()=>l.mode(i.HISTORY),memory:()=>l.mode(i.MEMORY)},location:l.methods()}}function H(e){let a=f(e,"href"),r=f(e,"exact",!0),n=f(e,"active-class",!0,"active");return{destroy:h.subscribe(t=>{let s=d(a,t.path);s&&(s.exact&&r||!r)?e.classList.add(n):e.classList.remove(n)})}}function P(e){let a=r=>{let n=r.target.closest("a[href]"),t=n&&f(n,"target",!1,"_self"),s=n&&f(n,"tinro-ignore"),o=r.ctrlKey||r.metaKey||r.altKey||r.shiftKey;if(t=="_self"&&!s&&!o&&n){let c=n.getAttribute("href").replace(/^\/#/,"");/^\/\/|^[a-zA-Z]+:/.test(c)||(r.preventDefault(),e(c.startsWith("/")?c:n.href.replace(window.location.origin,"")))}};return addEventListener("click",a),()=>removeEventListener("click",a)}function Q(){return F("tinro").meta.params}import{hasContext as U,getContext as j,setContext as W,onMount as z,tick as D}from"svelte";import{writable as I}from"svelte/store";var g="tinro",K=$({pattern:"",matched:!0});function E(e){let a=j(g)||K;(a.exact||a.fallback)&&k(`${e.fallback?"<Route fallback>":`<Route path="${e.path}">`}  can't be inside ${a.fallback?"<Route fallback>":`<Route path="${a.path||"/"}"> with exact path`}`);let r=e.fallback?"fallbacks":"childs",n=I({}),t=$({fallback:e.fallback,parent:a,update(s){t.exact=!s.path.endsWith("/*"),t.pattern=p(`${t.parent.pattern||""}${s.path}`),t.redirect=s.redirect,t.firstmatch=s.firstmatch,t.breadcrumb=s.breadcrumb,t.match()},register:()=>(t.parent[r].add(t),()=>{t.parent[r].delete(t),t.router.un&&t.router.un()}),show:()=>{e.onShow(),!t.fallback&&t.parent.activeChilds.add(t)},hide:()=>{e.onHide(),!t.fallback&&t.parent.activeChilds.delete(t)},match:async()=>{t.matched=!1;let{path:s,url:o,from:c,query:m}=t.router.location,u=d(t.pattern,s);if(!t.fallback&&u&&t.redirect&&(!t.exact||t.exact&&u.exact)){let L=x(s,t.parent.pattern,t.redirect);return h.goto(L,!0)}t.meta=u&&{from:c,url:o,query:m,match:u.part,pattern:t.pattern,breadcrumbs:t.parent.meta&&t.parent.meta.breadcrumbs.slice()||[],params:u.params,subscribe:n.subscribe},t.breadcrumb&&t.meta&&t.meta.breadcrumbs.push({name:t.breadcrumb,path:u.part}),n.set(t.meta),u&&!t.fallback&&(!t.exact||t.exact&&u.exact)&&(!t.parent.firstmatch||!t.parent.matched)?(e.onMeta(t.meta),t.parent.matched=!0,t.show()):t.hide(),u&&t.showFallbacks()}});return W(g,t),z(()=>t.register()),t}function b(){return U(g)?j(g).meta:k("meta() function must be run inside any `<Route>` child component only")}function $(e){let a={router:{},exact:!1,pattern:null,meta:null,parent:null,fallback:!1,redirect:!1,firstmatch:!1,breadcrumb:null,matched:!1,childs:new Set,activeChilds:new Set,fallbacks:new Set,async showFallbacks(){if(!this.fallback&&(await D(),this.childs.size>0&&this.activeChilds.size==0||this.childs.size==0&&this.fallbacks.size>0)){let r=this;for(;r.fallbacks.size==0;)if(r=r.parent,!r)return;r&&r.fallbacks.forEach(n=>{if(n.redirect){let t=x("/",n.parent.pattern,n.redirect);h.goto(t,!0)}else n.show()})}},start(){this.router.un||(this.router.un=h.subscribe(r=>{this.router.location=r,this.pattern!==null&&this.match()}))},match(){this.showFallbacks()}};return Object.assign(a,e),a.start(),a}export{H as active,E as createRouteObject,b as meta,h as router};
