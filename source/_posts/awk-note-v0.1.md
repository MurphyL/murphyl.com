----
title: AWK使用笔记
date: 2016-11-02
tags: 
    - awk
    - linux
    - shell
----

AWK是一个强大的文本分析工具，Linux及Unix环境中现有的功能最强大的数据处理引擎之一。AWK在很多方面类似于Unix shell编程语言，尽管AWK具有完全属于其本身的语法。其创造之初的目的很好的说明了其应用场景——只要在输入数据中有模式匹配，就执行一系列指令。该实用工具扫描文件中的每一行，查找与命令行中所给定内容相匹配的模式。如果发现匹配内容，则进行下一个编程步骤。如果找不到匹配内容，则继续处理下一行。

<!-- more -->

> AWK是一种处理文本文件的语言。它将文件作为记录序列处理。在一般情况下，文件内容的每行都是一个记录。每行内容都会被分割成一系列的域，因此，我们可以认为一行的第一个词为第一个域，第二个词为第二个，以此类推。AWK程序是由一些处理特定模式的语句块构成的。AWK一次可以读取一个输入行。对每个输入行，AWK解释器会判断它是否符合程序中出现的各个模式，并执行符合的模式所对应的动作。

AWK程序是由一系列模式/动作对组成的，写做：

```shell
pattern { action }
```

其中pattern表示AWK在数据中查找的内容，而action是在找到匹配内容时所执行的一系列命令。

----

将文件内的每一行以空格分隔，打印每一行的第五列：

```shell
awk '{print $5}' {{filename}}
```

通过正则表达式匹配文件内的每一行，然后将行内容以空格分隔，打印每一行的第二列：

```shell
awk '/{{regexp}}/ {print $2}' {{filename}}
awk '$1 ~ /{{regexp}}/ {print $2}' {{filename}}
```

指定分隔符，输出每一行的列的数量

```shell
awk -F ',' '{print $NF}' {{filename}}
```

### 语句定义

1. 可以快速的用单引号’ ’，把所有语句写成一行；
2. 也可以用-f 指定文件，文件里可以任意换行，增加可读性和重用性；
3. 所有执行语句用{}括起来，{}的外面是一些高级的东西比如过滤条件；
4. 另外如果打印整列，{print} 可省略不写；

### 内置常量


NR | Number of row | 行号
-- | -- | --
NF | Number of field | 列号

### 列引用

1. $0代表整行所有数据，$1代表第一列(终于不是程序员数数从0开始了)；
2. NF是个代表总列数的系统变量，所以$NF代表最后一列，还支持$(NF-1)来表示倒数第二列；
3. 还支持列之间的运算，如$NF-$(NF-1)是最后两列的值相减；

只写一个print 是 print $0的简写，打印整行所有数据；

## 参考资料

- [Wikipedia - AWK](https://zh.wikipedia.org/wiki/AWK)